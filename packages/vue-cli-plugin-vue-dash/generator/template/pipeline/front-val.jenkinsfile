pipeline {
	agent any
	options {
		timeout(time: 1, unit: 'HOURS')
	}
	environment {
        CLUSTER_ID = 'ge5'
    }
	stages {
		stage('Build JS') {
			steps {
				echo 'Building...'
				echo "Running ${env.BUILD_ID} on ${env.JENKINS_URL}"
				openshiftBuild(bldCfg: "${env.PROJECT}-front-js-build", showBuildLogs: 'true', namespace: "${env.PROJECT}-val", waitTime: '30', waitUnit: 'min')
			}
		}
		stage('Test JS Build Availability') {
			steps {
				openshiftVerifyBuild(bldCfg: "${env.PROJECT}-front-js-build", namespace: "${env.PROJECT}-val")
			}
		}
		stage('Build') {
			steps {
				echo 'Building...'
				echo "Running ${env.BUILD_ID} on ${env.JENKINS_URL}"
				openshiftBuild(bldCfg: "${env.PROJECT}-front-build", showBuildLogs: 'true', namespace: "${env.PROJECT}-val")
			}
		}
		stage('Test Build Availability') {
			steps {
				openshiftVerifyBuild(bldCfg: "${env.PROJECT}-front-build", namespace: "${env.PROJECT}-val")
			}
		}
		stage('Deploy Image to val') {
			steps {
				openshiftTag(srcStream: "${env.PROJECT}-front", srcTag: 'build', destStream: "${env.PROJECT}-front", destTag: 'val', destinationNamespace: "${env.PROJECT}-val", namespace: "${env.PROJECT}-val")
			}
		}
		stage('Deploy Availability de val') {
			steps {
				openshiftVerifyDeployment(depCfg: "${env.PROJECT}-front-val", namespace: "${env.PROJECT}-val", waitTime: '10', waitUnit: 'min')
			}
		}
	}
}
